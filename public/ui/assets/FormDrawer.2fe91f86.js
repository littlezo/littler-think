var e=(e,r,a)=>new Promise(((o,t)=>{var s=e=>{try{n(a.next(e))}catch(r){t(r)}},l=e=>{try{n(a.throw(e))}catch(r){t(r)}},n=e=>e.done?o(e.value):Promise.resolve(e.value).then(s,l);n((a=a.apply(e,r)).next())}));import{g as r,h as a}from"./useForm.137eb3b0.js";import{B as o,a as t}from"./index.45c45527.js";import{ae as s}from"./index.85303d5a.js";import l from"./PersonTable.68955b3d.js";import{Card as n}from"ant-design-vue";import{A as i,r as u,j as d,u as c,Z as m,F as p,G as f,a1 as v,x as b,a6 as g,a0 as h}from"./vendor.ecc5e6ce.js";import"./index.c389a080.js";import"./useAttrs.b84cef3f.js";import"./index.0f139360.js";import"./useWindowSizeFn.1b287cdc.js";import"./index.5c4cad53.js";import"./download.8120b7a2.js";import"./index.241dae1f.js";import"./TableImg.dcd306f8.js";import"./onMountedOrActivated.6e7c6753.js";import"./useSortable.6200a744.js";import"./useTable.a2da2945.js";var j=i({name:"FormDrawer",components:{BasicDrawer:o,BasicForm:r,PersonTable:l,[n.name]:n},emits:["success","register"],setup(r,{emit:o}){const l=u("操作"),n=u(0),i=u({method:"",api:""}),m=u(!1),p=u(!0),f=u([]),v=u([]),b=u(""),g=u(null),[h,{resetFields:j,setProps:w,validate:R}]=a({labelWidth:100,baseColProps:{xxl:6,xl:8,lg:12,md:24},showActionButtonGroup:!1}),[x,{setDrawerProps:F,closeDrawer:S}]=t((r=>e(this,null,(function*(){var e,a,o,t,s;const u=null!=(e=null==r?void 0:r.props)?e:{};j(),w(u);const d=null!=(o=null==(a=null==r?void 0:r.props)?void 0:a.record)?o:{};u.schemas||(p.value=!1),u.columns&&(f.value=u.columns,v.value=(null==d?void 0:d[u.field])||[],m.value=!0,b.value=u.field,F({width:800})),F({confirmLoading:!1}),n.value=null==r?void 0:r.pk,i.value=null==(t=null==r?void 0:r.props)?void 0:t.api,l.value=null==(s=null==r?void 0:r.props)?void 0:s.title}))));return{registerDrawer:x,registerForm:h,getTitle:d((()=>c(l))),tableRef:g,columnsRef:f,dataSourceRef:v,tableOpenRef:m,formOpenRef:p,handleSubmit:function(){return e(this,null,(function*(){try{let e=[];g.value&&(e=g.value.getDataSource().map((function(e){return c(e.editValueRefs)})));const r=yield R(),a=Object.assign(r||{},{[c(b)]:e});F({confirmLoading:!0}),s(i.value.method,i.value.api+"/"+n.value,a).then((e=>{S(),o("success")}))}finally{F({confirmLoading:!1})}}))}}}});j.render=function(e,r,a,o,t,s){const l=m("BasicForm"),n=m("a-card"),i=m("PersonTable"),u=m("BasicDrawer");return p(),f(u,h(e.$attrs,{onRegister:e.registerDrawer,showFooter:"",title:e.getTitle,width:"500px",onOk:e.handleSubmit}),{default:v((()=>[e.formOpenRef?(p(),f(n,{key:0,bordered:!1,class:"!mt-5"},{default:v((()=>[b(l,{onRegister:e.registerForm},null,8,["onRegister"])])),_:1})):g("",!0),e.tableOpenRef?(p(),f(n,{key:1,bordered:!1},{default:v((()=>[b(i,{columns:e.columnsRef,dataSource:e.dataSourceRef,ref:"tableRef"},null,8,["columns","dataSource"])])),_:1})):g("",!0)])),_:1},16,["onRegister","title","onOk"])};export{j as default};
