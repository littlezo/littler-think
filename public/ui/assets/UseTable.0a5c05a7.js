var __defProp=Object.defineProperty,__defProps=Object.defineProperties,__getOwnPropDescs=Object.getOwnPropertyDescriptors,__getOwnPropSymbols=Object.getOwnPropertySymbols,__hasOwnProp=Object.prototype.hasOwnProperty,__propIsEnum=Object.prototype.propertyIsEnumerable,__defNormalProp=(e,t,a)=>t in e?__defProp(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a,__spreadValues=(e,t)=>{for(var a in t||(t={}))__hasOwnProp.call(t,a)&&__defNormalProp(e,a,t[a]);if(__getOwnPropSymbols)for(var a of __getOwnPropSymbols(t))__propIsEnum.call(t,a)&&__defNormalProp(e,a,t[a]);return e},__spreadProps=(e,t)=>__defProps(e,__getOwnPropDescs(t)),__async=(e,t,a)=>new Promise(((o,r)=>{var n=e=>{try{i(a.next(e))}catch(t){r(t)}},s=e=>{try{i(a.throw(e))}catch(t){r(t)}},i=e=>e.done?o(e.value):Promise.resolve(e.value).then(n,s);i((a=a.apply(e,t)).next())}));import{_ as _sfc_main$2}from"./TableImg.dcd306f8.js";import{_ as _sfc_main$6}from"./useForm.137eb3b0.js";import{u as useTable}from"./useTable.a2da2945.js";import{ac as usePermission,ad as getSlot,w as withInstall,ae as api,r as useTimeoutFn}from"./index.85303d5a.js";import{A as defineComponent,N as reactive,r as ref,a as useRouter,j as computed,u as unref,X as onMounted,T as toRefs,Z as resolveComponent,F as openBlock,G as createBlock,x as createVNode,a1 as withCtx,a5 as Fragment,ah as renderList,a7 as createTextVNode,K as toDisplayString,a6 as createCommentVNode}from"./vendor.ecc5e6ce.js";import{u as useModal}from"./index.0f139360.js";import{_ as _sfc_main$3,o as objectToFunction}from"./FormModal.a797aafd.js";import{u as useDrawer}from"./index.45c45527.js";import _sfc_main$4 from"./FormDrawer.2fe91f86.js";import _sfc_main$5 from"./DetailDrawer.3b1fcbf3.js";import"ant-design-vue";import"./useWindowSizeFn.1b287cdc.js";import"./onMountedOrActivated.6e7c6753.js";import"./useSortable.6200a744.js";import"./index.c389a080.js";import"./useAttrs.b84cef3f.js";import"./index.5c4cad53.js";import"./download.8120b7a2.js";import"./index.241dae1f.js";import"./PersonTable.68955b3d.js";import"./index.a0037c0b.js";var _sfc_main$1=defineComponent({name:"Authority",props:{value:{type:[Number,Array,String],default:""}},setup(e,{slots:t}){const{hasPermission:a}=usePermission();return()=>function(){const{value:o}=e;return o?a(o)?getSlot(t):null:getSlot(t)}()}});const Authority=withInstall(_sfc_main$1);var _sfc_main=defineComponent({components:{BasicTable:_sfc_main$2,FormModal:_sfc_main$3,FormDrawer:_sfc_main$4,DetailDrawer:_sfc_main$5,TableAction:_sfc_main$6,Authority:Authority},setup(){var _a,_b,_c;const state=reactive({rowKey:"id"}),tableSchemaRef=ref({actions:"",dropActions:""}),{currentRoute:currentRoute}=useRouter(),getRourer=computed((()=>unref(currentRoute))),meta=getRourer.value.meta,apiRef=ref({});meta.action.map((function(e){Object.assign(unref(apiRef),{[e.auth.split(":").slice(-1)]:{method:e.method,api:e.api,auth:e.permission}})}));const listApi=(null==(_a=unref(apiRef))?void 0:_a.page)?null==(_b=unref(apiRef))?void 0:_b.page:null==(_c=unref(apiRef))?void 0:_c.list,[registerModal,{openModal:openModal}]=useModal(),[registerTable,{setProps:setProps,getSelectRowKeys:getSelectRowKeys,reload:reload}]=useTable({api:e=>{var t,a;return api(null!=(t=null==listApi?void 0:listApi.method)?t:meta.method,null!=(a=null==listApi?void 0:listApi.api)?a:meta.api,__spreadValues({},e))}}),[registerDrawer,{openDrawer:openDrawer}]=useDrawer(),[registerDetail,{openDrawer:openDetail}]=useDrawer();function handleCreate(){openModal(!0,{isUpdate:!1})}function handleDetail(e){openDetail(!0,{record:e})}function handleRowPart(e,t){openDrawer(!0,{pk:e[state.rowKey],props:t})}function handleView(e){openModal(!0,{record:e,isView:!0,isUpdate:!0,pk:state.rowKey})}function handleEdit(e){openModal(!0,{record:e,isUpdate:!0,pk:state.rowKey})}function handleDelete(e){api("delete",meta.api+"/"+e[state.rowKey]).then((()=>{handleSuccess()}))}function handleActions(record,column,type){var _a2,_b2;if(handleCreate.bind(null,record,column),"column"===type){const col_action=unref(tableSchemaRef).actions,actions=null!=(_a2=eval(col_action))?_a2:[];return actions}const drop_action=unref(tableSchemaRef).dropActions,actions=null!=(_b2=eval(drop_action))?_b2:[];return actions}function handleSuccess(){reload()}return onMounted((()=>__async(this,null,(function*(){var e;const t=yield api(meta.method,meta.api+"/layout",{type:"table"});t.actions=null==(e=null==t?void 0:t.actions)?void 0:e.replace(/[\r\n]/g,"").replace(/\ +/g,""),objectToFunction(t),state.rowKey=(null==t?void 0:t.rowKey)||"id",tableSchemaRef.value=t,useTimeoutFn((()=>{setProps(__spreadValues({api:e=>{var t,a,o,r,n,s;return api(null!=(o=null==(a=null==(t=unref(apiRef))?void 0:t.list)?void 0:a.method)?o:meta.method,null!=(s=null==(n=null==(r=unref(apiRef))?void 0:r.list)?void 0:n.api)?s:meta.api,__spreadValues({},e))},canResize:!0,canColDrag:!0,isTreeTable:!0,useSearchForm:!0,showTableSetting:!0,showIndexColumn:!1,rowKey:"id",bordered:!0,striped:!0,searchInfo:{order:"asc"},title:meta.title},t))}),50)})))),__spreadProps(__spreadValues({},toRefs(state)),{meta:meta,apiRef:apiRef,handleRowPart:handleRowPart,handleActions:handleActions,registerDrawer:registerDrawer,registerDetail:registerDetail,registerModal:registerModal,tableSchemaRef:tableSchemaRef,registerTable:registerTable,handleCreate:handleCreate,handleView:handleView,handleEdit:handleEdit,handleDelete:handleDelete,handleDetail:handleDetail,handleSuccess:handleSuccess})}});const _hoisted_1={class:"p-4"};function _sfc_render(e,t,a,o,r,n){const s=resolveComponent("a-button"),i=resolveComponent("Authority"),l=resolveComponent("TableAction"),c=resolveComponent("BasicTable"),d=resolveComponent("FormModal"),p=resolveComponent("FormDrawer"),u=resolveComponent("DetailDrawer");return openBlock(),createBlock("div",_hoisted_1,[createVNode(c,{onRegister:e.registerTable},{toolbar:withCtx((()=>[(openBlock(!0),createBlock(Fragment,null,renderList(e.meta.action,(t=>(openBlock(),createBlock("div",{key:t.id},[-1!==t.auth.split(":").lastIndexOf("save")?(openBlock(),createBlock(i,{key:0,value:t.auth},{default:withCtx((()=>[createVNode(s,{type:"primary",onClick:e.handleCreate},{default:withCtx((()=>[createTextVNode(toDisplayString(t.title),1)])),_:2},1032,["onClick"])])),_:2},1032,["value"])):createCommentVNode("",!0)])))),128))])),action:withCtx((({record:t,column:a})=>[createVNode(l,{actions:e.handleActions(t,a,"column")},null,8,["actions"]),createVNode(l,{dropDownActions:e.handleActions(t,a,"drop")},null,8,["dropDownActions"])])),_:1},8,["onRegister"]),createVNode(d,{onRegister:e.registerModal,onSuccess:e.handleSuccess},null,8,["onRegister","onSuccess"]),createVNode(p,{onRegister:e.registerDrawer,onSuccess:e.handleSuccess},null,8,["onRegister","onSuccess"]),createVNode(u,{onRegister:e.registerDetail},null,8,["onRegister"])])}_sfc_main.render=_sfc_render;export{_sfc_main as default};
