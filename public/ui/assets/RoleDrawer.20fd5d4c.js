var e=Object.defineProperty,t=Object.getOwnPropertySymbols,a=Object.prototype.hasOwnProperty,r=Object.prototype.propertyIsEnumerable,l=(t,a,r)=>a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[a]=r,s=(e,t,a)=>new Promise(((r,l)=>{var s=e=>{try{o(a.next(e))}catch(t){l(t)}},n=e=>{try{o(a.throw(e))}catch(t){l(t)}},o=e=>e.done?r(e.value):Promise.resolve(e.value).then(s,n);o((a=a.apply(e,t)).next())}));import{g as n,h as o}from"./useForm.137eb3b0.js";import{Switch as i}from"ant-design-vue";import{s as d}from"./index.4fb81140.js";import{h as c,aT as u,aN as p,aO as m}from"./index.85303d5a.js";import{ac as f,A as b,r as h,u as v,j as g,Z as y,F as w,G as x,a1 as _,x as S,a0 as I}from"./vendor.ecc5e6ce.js";import{B as j,a as k}from"./index.45c45527.js";import{_ as D}from"./Tree.vue_vue&type=style&index=0&lang.b0f45418.js";const O=[{title:"角色名称",dataIndex:"name",width:200},{title:"角色标识",dataIndex:"identify",width:180},{title:"排序",dataIndex:"sort",width:50},{title:"状态",dataIndex:"status",width:120,customRender:({record:e})=>(Reflect.has(e,"pendingStatus")||(e.pendingStatus=!1),f(i,{checked:1===e.status,checkedChildren:"已启用",unCheckedChildren:"已禁用",loading:e.pendingStatus,onChange(t){e.pendingStatus=!0;const a=t?1:0,{createMessage:r}=c();d(e.id,{status:a}).then((()=>{e.status=a,r.success("已成功修改角色状态")})).catch((()=>{r.error("修改角色状态失败")})).finally((()=>{e.pendingStatus=!1}))}}))},{title:"创建时间",dataIndex:"create_time",width:180},{title:"备注",dataIndex:"remark"}],P=[{field:"like_name",label:"角色名称",component:"Input",colProps:{span:8}},{field:"status",label:"状态",component:"Select",componentProps:{options:[{label:"启用",value:1},{label:"停用",value:0}]},colProps:{span:8}}],B=[{field:"name",label:"角色名称",required:!0,component:"Input"},{field:"identify",label:"角色标识",required:!0,component:"Input"},{field:"data_range",label:"数据权限",component:"RadioButtonGroup",defaultValue:1,componentProps:{options:[{label:"全部数据",value:1},{label:"自定义数据",value:2},{label:"仅本人数据",value:3},{label:"部门数据",value:4},{label:"部门及以下数据",value:5}]}},{field:"sort",label:"排序",defaultValue:"100",component:"InputNumber",required:!0},{field:"status",label:"状态",component:"RadioButtonGroup",defaultValue:1,componentProps:{options:[{label:"启用",value:1},{label:"停用",value:0}]}},{label:"备注",field:"remark",component:"InputTextArea"},{label:" ",field:"access_ids",slot:"access_ids",component:"Input"}];var F=b({name:"RoleDrawer",components:{BasicDrawer:j,BasicForm:n,BasicTree:D},emits:["success","register"],setup(e,{emit:n}){const i=h(!0),d=h([]),c=h(0),[f,{resetFields:b,setFieldsValue:y,validate:w}]=o({labelWidth:90,schemas:B,showActionButtonGroup:!1}),[x,{setDrawerProps:_,closeDrawer:S}]=k((e=>s(this,null,(function*(){var s;b(),_({confirmLoading:!1}),i.value=!!(null==e?void 0:e.isUpdate),c.value=null==(s=null==e?void 0:e.record)?void 0:s.id,v(i)&&y(((e,s)=>{for(var n in s||(s={}))a.call(s,n)&&l(e,n,s[n]);if(t)for(var n of t(s))r.call(s,n)&&l(e,n,s[n]);return e})({},e.record)),d.value=yield u({children:"children",order:"asc"})}))));return{registerDrawer:x,registerForm:f,getTitle:g((()=>v(i)?"编辑角色":"新增角色")),handleSubmit:function(){return s(this,null,(function*(){try{const e=yield w();_({confirmLoading:!0}),v(i)?p("/user/roles",c.value,e).then((e=>{S(),n("success")})):m("/user/roles",e).then((e=>{S(),n("success")})),n("success")}finally{_({confirmLoading:!1})}}))},treeData:d}}});F.render=function(e,t,a,r,l,s){const n=y("BasicTree"),o=y("BasicForm"),i=y("BasicDrawer");return w(),x(i,I(e.$attrs,{onRegister:e.registerDrawer,showFooter:"",title:e.getTitle,width:"500px",onOk:e.handleSubmit}),{default:_((()=>[S(o,{onRegister:e.registerForm},{access_ids:_((({model:t,field:a})=>[S(n,{value:t[a],"onUpdate:value":e=>t[a]=e,treeData:e.treeData,replaceFields:{title:"title",key:"id"},checkable:"",showCheckedStrategy:"TreeSelect.SHOW_ALL",title:"权限分配"},null,8,["value","onUpdate:value","treeData"])])),_:1},8,["onRegister"])])),_:1},16,["onRegister","title","onOk"])};var R=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",default:F});export{R,F as _,O as c,P as s};
